@{
    ViewData["Title"] = "Roles";
}
<div class="app-page-title">
    <div class="page-title-wrapper">
        <div class="page-title-heading">
            <div class="page-title-icon">
                <i class="pe-7s-users icon-gradient bg-tempting-azure">
                </i>
            </div>
            <div>
                Roles
                <div class="page-title-subheading">
                    <a title="Home" href="@Url.Content("~/Home")">Home</a> / Roles
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
	<div class="col-lg-12">
		<div class="main-card mb-12 card">
			<div class="card-header">
				<button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target=".modalAdd" id="btnAdd"><i class="fa fa-plus"></i> Add</button>
			</div>
			<div class="card-body">
				<table class="display" id="table1" style="width:100%">
					<thead>
						<tr>
							<th>Action</th>
							<th>Name</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody></tbody>
				</table>
			</div>
		</div>
	</div>
</div>
@section Modal {
	<div class="modal fade modalAdd" tabindex="-1" role="dialog" aria-labelledby="modalAdd" aria-hidden="true" id="modalAdd">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="modalAddTitle">Add Role</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<form id="formModalAdd" method="POST" action="@Url.Content("~/Roles/CreateOrUpdate")">
					<div class="modal-body">
						<input type="hidden" name="id" id="id" value="" style="display: none" />
						<div class="position-relative row form-group">
							<label for="name" class="col-sm-2 col-form-label">Name</label>
							<div class="col-sm-10"><input name="name" id="name" placeholder="Name" type="text" class="form-control" required="" maxlength="50" ></div>
						</div>
						<div class="position-relative row form-group">
							<label for="description" class="col-sm-2 col-form-label">Description</label>
							<div class="col-sm-10"><textarea name="description" id="description" class="form-control" placeholder="Description" style="resize:none" required="" maxlength="200"></textarea></div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnClose">Close</button>
						<button type="submit" class="btn btn-primary" id="btnSave">Save</button>
					</div>
				</form>
			</div>
		</div>
	</div>
}
@section Scripts {
	<script type="text/javascript">
		$(function () {
			var table = $('#table1').DataTable({
				ajax: {
					url: "Roles/GetAllData",
					type: "POST",
				},
				processing: true,
				serverSide: true,
				filter: false,
				order: [[1, 'asc']],
				columns: [
					{ defaultContent: '<i class="fa fa-eye btnView" style="cursor:pointer" data-toggle="modal" data-target=".modalAdd"></i> &nbsp; <i class="fa fa-edit btnEdit" style="cursor:pointer" data-toggle="modal" data-target=".modalAdd"></i> &nbsp; <i class="fa fa-trash btnDelete" style="cursor:pointer"></i>' },
					{ data: "name", name: "name" },
					{ data: "description", name: "description" }
				]
			});

			$('#table1 tbody').on('click', '.btnView', function () {
				var row = $(this).closest('tr');
				var id = table.row(row).data()["id"];

				$('#modalAddTitle').text('View Role');
				$('#btnSave').hide();
				$("#formModalAdd :input").prop("disabled", true);
				$("#btnClose").prop("disabled", false);

				$.ajax({
					type: 'GET',
					url: '@Url.Content("~/Roles/GetById/")' + id,
					success: function (data) {
						$('#name').val(data.name);
						$('#description').val(data.description);
					}
				});
			});

			$('#table1 tbody').on('click', '.btnEdit', function () {
				var row = $(this).closest('tr');
				var id = table.row(row).data()["id"];

				$('#modalAddTitle').text('Edit Role');
				$('#btnSave').show();
				$("#formModalAdd :input").prop("disabled", false);

				$.ajax({
					type: 'GET',
					url: '@Url.Content("~/Roles/GetById/")' + id,
					success: function (data) {
						$('#id').val(data.id);
						$('#name').val(data.name);
						$('#description').val(data.description);
					}
				});
			});

			$('#table1 tbody').on('click', '.btnDelete', function () {
				var row = $(this).closest('tr');
				var id = table.row(row).data()["id"];

				Swal.fire({
					title: "Are you sure want to delete?",
					showCancelButton: true,
					confirmButtonText: "Delete",
				}).then((result) => {
					if (result.isConfirmed) {

						$.ajax({
							type: 'DELETE',
							url: '@Url.Content("~/Roles/Delete/")' + id,
							success: function (data) {
								table.ajax.reload();
							}
						});
					}
				});
			});

			$('#btnAdd').click(function () {
				$('#modalAddTitle').text('Add Role');
				$('#btnSave').show();
				$("#formModalAdd :input").prop("disabled", false);
				$("#formModalAdd :input").val('');
			});

			$('#formModalAdd').submit(function (e) {
				e.preventDefault();

				let form = $(this);
				let actionUrl = form.attr('action');

				$.ajax({
					type: 'POST',
					url: actionUrl,
					data: form.serialize(),
					success: function (data) {
						ShowMessage("success", data);
						$("#btnClose").click();
						table.ajax.reload();
					},
					error: function (data) {
						ShowMessage("error", data.responseText);
					}
				});
			});

		});
	</script>
}